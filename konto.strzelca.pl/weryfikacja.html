<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Weryfikacja konta - strzelca.pl">
    <meta name="author" content="Strzelca.pl">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="https://strzelca.pl/ikona.svg">
    <link rel="apple-touch-icon" href="https://strzelca.pl/ikona.svg">

    <title>Weryfikacja - strzelca.pl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --coyote: #C19A6B; }
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e5e5e5; margin: 0; overflow-x: hidden; }
        .main-wrapper { min-height: 100vh; width: 100%; background: linear-gradient(rgba(10,10,10,0.1) 0%, rgba(10,10,10,0.4) 50%, #0a0a0a 100%), url('https://strzelca.pl/tlo.png'); background-size: cover; background-position: top center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .coyote-text { color: var(--coyote); font-family: 'Orbitron'; }
        .spinner { border: 4px solid #333; border-top: 4px solid var(--coyote); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .verification-card { background: rgba(20, 20, 20, 0.95); border: 1px solid #333; border-radius: 20px; padding: 40px; text-align: center; max-width: 500px; width: 90%; }
        .checkmark { width: 80px; height: 80px; margin: 0 auto 20px; position: relative; animation: checkmark-appear 1s ease-in-out; }
        .checkmark::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(45deg); width: 25px; height: 40px; border: solid #10b981; border-width: 0 5px 5px 0; }
        @keyframes checkmark-appear { 0% { opacity: 0; transform: scale(0.3); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
    </style>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9EJ2R3JPVD"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9EJ2R3JPVD');
    </script>
</head>
<body>
    <div class="main-wrapper">
        <div class="verification-card">
            <div id="verification-content">
                <div class="checkmark"></div>
                <h1 class="text-2xl md:text-3xl font-bold coyote-text uppercase italic font-[Orbitron] mb-4">
                    WERYFIKACJA STRZELCA
                </h1>
                <p class="text-lg mb-8 text-zinc-300">
                    Przenoszę do Strefy Strzelca.
                </p>
                <div class="spinner"></div>
                <p id="countdown" class="text-sm text-zinc-400 mt-4 cursor-pointer hover:text-coyote hover:underline transition-colors">Przekierowanie za 5 sekund...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        
      async function getFirebaseApiKey() {
        const urls = [
          "https://strzelca.pl/api/firebase-config",
          "/api/firebase-config",
        ];

        for (const url of urls) {
          try {
            const res = await fetch(url, { cache: "no-store" });
            if (!res.ok) continue;
            const data = await res.json().catch(() => null);
            if (data && typeof data.apiKey === "string" && data.apiKey.length > 10) {
              return data.apiKey;
            }
          } catch (_) {
            // ignore and try next url
          }
        }

        throw new Error("Nie udało się pobrać FIREBASE_WEB_API_KEY z /api/firebase-config");
      }
const firebaseConfig = {
            apiKey: await getFirebaseApiKey(),
            authDomain: "strzelca-pl.firebaseapp.com",
            projectId: "strzelca-pl",
            storageBucket: "strzelca-pl.firebasestorage.app",
            messagingSenderId: "511362047688",
            appId: "1:511362047688:web:9b82c0a4d19c1a3a878ffd",
            measurementId: "G-9EJ2R3JPVD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Ustaw trwałość sesji na LOCAL
        await setPersistence(auth, browserLocalPersistence);

        // Listener stanu autoryzacji
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Użytkownik jest zalogowany - można kontynuować weryfikację
                console.log('Użytkownik zalogowany podczas weryfikacji');
            } else {
                // Użytkownik niezalogowany - przekieruj do logowania
                console.log('Użytkownik niezalogowany podczas weryfikacji, przekierowanie do login.html');
                window.location.href = 'login.html';
            }
        });

        const auth = firebase.auth();
        let countdown = 5;
        const countdownElement = document.getElementById('countdown');

        // Funkcja odliczania
        function startCountdown() {
            const timer = setInterval(() => {
                countdownElement.textContent = `Przekierowanie za ${countdown} sekund...`;
                countdown--;

                if (countdown < 0) {
                    clearInterval(timer);
                    window.location.href = 'https://strzelca.pl/index.html';
                }
            }, 1000);

            // Obsługa kliknięcia w napis
            countdownElement.addEventListener('click', () => {
                clearInterval(timer);
                window.location.href = 'https://strzelca.pl/index.html';
            });
        }

        // Sprawdź czy mamy kod weryfikacyjny w URL
        const urlParams = new URLSearchParams(window.location.search);
        const actionCode = urlParams.get('oobCode');

        if (actionCode) {
            auth.applyActionCode(actionCode)
                .then(() => {
                    console.log('Email zweryfikowany pomyślnie');
                    startCountdown();
                })
                .catch((error) => {
                    console.error('Błąd weryfikacji:', error);
                    document.getElementById('verification-content').innerHTML = `
                        <i class="fa-solid fa-exclamation-triangle text-6xl text-red-500 mb-6"></i>
                        <h1 class="text-2xl md:text-3xl font-bold text-red-500 uppercase italic font-[Orbitron] mb-4">
                            Błąd weryfikacji
                        </h1>
                        <p class="text-lg mb-4 text-zinc-300">
                            Link wygasł lub jest niepoprawny.
                        </p>
                        <a href="https://konto.strzelca.pl/login.html" class="inline-block bg-coyote text-black px-6 py-3 rounded-lg font-semibold hover:bg-white transition">
                            Powrót do logowania
                        </a>
                    `;
                });
        } else {
            // Brak kodu weryfikacyjnego - przekieruj na stronę główną
            startCountdown();
        }
    </script>
    <script
      type="module"
      src="https://strzelca.pl/auth-widget.mjs?v=2026-02-02-1"
    ></script>
    <script
      type="module"
      src="https://strzelca.pl/messages-widget.mjs?v=2026-02-05-1"
    ></script>
  </body>
</html>