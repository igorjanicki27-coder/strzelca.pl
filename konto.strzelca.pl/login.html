<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logowanie - strzelca.pl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --coyote: #C19A6B; }
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e5e5e5; margin: 0; }
        .coyote-text { color: var(--coyote); font-family: 'Orbitron'; }

        input {
            background: #111 !important;
            border: 1px solid #222 !important;
            color: white !important;
            padding: 16px 20px !important;
            border-radius: 12px;
            width: 100%;
            outline: none;
            transition: 0.3s;
        }
        input:focus {
            border-color: var(--coyote) !important;
            background: #161616 !important;
        }

        .btn-login {
            background: var(--coyote);
            color: black;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 20px;
            border-radius: 12px;
            transition: 0.3s;
            cursor: pointer;
            width: 100%;
        }
        .btn-login:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(193, 154, 107, 0.2); }
        .btn-login:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .error-message {
            color: #ef4444;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>

    <nav class="h-[73px] border-b border-zinc-900 sticky top-0 bg-black/95 z-50 backdrop-blur-md flex items-center relative">
        <a href="https://strzelca.pl" class="absolute left-4 md:left-8 text-zinc-500 hover:text-white transition text-xl">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <div class="container mx-auto px-6 flex justify-center">
            <div class="uppercase font-bold text-[11px] tracking-[0.3em] font-[Orbitron] text-zinc-400">
                LOGOWANIE.<span class="coyote-text">STRZELCA</span>.PL
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-20 max-w-md">
        <div class="bg-zinc-900/50 p-8 md:p-12 rounded-3xl border border-zinc-800 shadow-2xl">
            <h1 class="text-3xl md:text-4xl font-black uppercase italic font-[Orbitron] text-center mb-8">
                <span class="coyote-text">KONTO STRZELCA</span>
            </h1>

            <div class="relative my-6">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-zinc-600"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-zinc-900 text-zinc-400">lub</span>
                    </div>
                </div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="text-[10px] uppercase font-bold text-zinc-500 ml-2 mb-2 block tracking-widest">Adres email</label>
                        <input type="email" id="email" placeholder="jan.kowalski@email.com" required>
                    </div>

                    <div>
                        <label class="text-[10px] uppercase font-bold text-zinc-500 ml-2 mb-2 block tracking-widest">Hasło</label>
                        <input type="password" id="password" placeholder="Twoje hasło" required>
                    </div>

                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <label class="flex items-center">
                            <input type="checkbox" id="remember" class="mr-2">
                            <span>Zapamiętaj STRZELCA</span>
                        </label>
                        <div class="text-right">
                            <button type="button" onclick="resetPassword()" class="text-coyote hover:underline">Zapomniałeś hasła?</button>
                        </div>
                    </div>

                    <button type="submit" class="btn-login" id="login-btn">
                        <i class="fa-solid fa-sign-in-alt mr-2"></i>
                        ZALOGUJ STRZELCA
                    </button>
                </form>

                <div class="text-center pt-4 border-t border-zinc-700">
                    <p class="text-zinc-400 text-sm">
                        Nie posiadasz konta Strzelca?<br>
                        <a href="./rejestracja.html" class="text-coyote hover:underline">Zarejestruj Strzelca</a>
                    </p>
                </div>
            </form>

            <div id="status-message" class="mt-6 p-4 rounded-lg text-center text-sm hidden"></div>
        </div>
    </main>

    <footer class="text-center py-10 border-t border-zinc-900 text-zinc-700 text-[10px] uppercase font-bold tracking-[0.4em]">
        <a href="https://strzelca.pl" class="hover:text-white transition">STRZELCA.PL</a> |
        <a href="https://dokumenty.strzelca.pl" class="hover:text-white transition ml-4">DOKUMENTY - REGULAMINY, ZWROTY ITP.</a>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, setPersistence, browserSessionPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD_gXFh3a4NW9Hzzsr5IQuDADM2GVpPMVc",
            authDomain: "strzelca-pl.firebaseapp.com",
            projectId: "strzelca-pl",
            storageBucket: "strzelca-pl.firebasestorage.app",
            messagingSenderId: "511362047688",
            appId: "1:511362047688:web:9b82c0a4d19c1a3a878ffd",
            measurementId: "G-9EJ2R3JPVD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        function showStatus(message, isError = false) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `mt-6 p-4 rounded-lg text-center text-sm ${isError ? 'bg-red-900/50 text-red-300 border border-red-700' : 'bg-green-900/50 text-green-300 border border-green-700'}`;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Funkcja resetowania hasła
        window.resetPassword = async () => {
            const email = document.getElementById('email').value.trim();

            if (!email) {
                showStatus('Wprowadź adres email, aby zresetować hasło.', true);
                document.getElementById('email').focus();
                return;
            }

            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showStatus('Wprowadź prawidłowy adres email.', true);
                document.getElementById('email').focus();
                return;
            }

            try {
                const { sendPasswordResetEmail } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");
                await sendPasswordResetEmail(auth, email, {
                    url: `${window.location.origin}/konto.strzelca.pl/akcja.html?mode=resetPassword`,
                    handleCodeInApp: true
                });

                showStatus('Link do resetowania hasła został wysłany na Twój adres email.');
            } catch (error) {
                console.error('Password reset error:', error);
                let errorMessage = 'Wystąpił błąd podczas wysyłania linku resetowania hasła.';

                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Nie znaleziono użytkownika z tym adresem email.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Nieprawidłowy format adresu email.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Zbyt wiele prób. Spróbuj ponownie później.';
                }

                showStatus(errorMessage, true);
            }
        };



        // Obsługa formularza logowania
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const loginBtn = document.getElementById('login-btn');
            const remember = document.getElementById('remember').checked;

            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Logowanie...';

            try {
                // Ustaw trwałość sesji
                await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);

                // Zaloguj użytkownika
                const userCredential = await signInWithEmailAndPassword(
                    auth,
                    document.getElementById('email').value.trim(),
                    document.getElementById('password').value
                );

                const user = userCredential.user;

                // Sprawdź czy email jest zweryfikowany
                if (!user.emailVerified) {
                    showStatus('Email nie został jeszcze zweryfikowany. Sprawdź swoją skrzynkę pocztową.', true);
                    return;
                }

                showStatus('Zalogowano pomyślnie! Przekierowanie...');

                // Przekieruj do strony głównej (globalny system się zajmie resztą)
                setTimeout(() => {
                    window.location.href = 'https://strzelca.pl/index.html';
                }, 1000);

            } catch (error) {
                console.error('Login error:', error);

                let errorMessage = 'Wystąpił błąd podczas logowania.';

                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Nie znaleziono użytkownika z tym adresem email.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Nieprawidłowe hasło.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Nieprawidłowy format adresu email.';
                } else if (error.code === 'auth/user-disabled') {
                    errorMessage = 'Konto zostało zablokowane.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Zbyt wiele prób logowania. Spróbuj ponownie później.';
                }

                showStatus(errorMessage, true);
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fa-solid fa-sign-in-alt mr-2"></i>Zaloguj się';
            }
        });
    </script>
</body>
</html>
