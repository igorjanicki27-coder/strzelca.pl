<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kontakt strzelca.pl - wsparcie techniczne, zamówienia, współpraca. Skontaktuj się z nami szybko i bezpiecznie.">
    <meta name="keywords" content="kontakt strzelca.pl, wsparcie, zamówienia, współpraca, pomoc techniczna">
    <meta name="author" content="Strzelca.pl">
    <meta name="robots" content="index, follow">

    <!-- Open Graph dla Facebook -->
    <meta property="og:title" content="kontakt.strzelca.pl | Wsparcie">
    <meta property="og:description" content="Kontakt z zespołem strzelca.pl - zamówienia, wsparcie, współpraca. Formularz kontaktowy dostępny 24/7.">
    <meta property="og:image" content="../tlo:logo/logo.czarne.png">
    <meta property="og:url" content="https://kontakt.strzelca.pl">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../ikona.svg">
    <link rel="apple-touch-icon" href="../ikona.svg">

    <title>kontakt.strzelca.pl | Wsparcie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --coyote: #C19A6B; }
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e5e5e5; margin: 0; }
        .hero-bg { height: 40vh; background: linear-gradient(rgba(10,10,10,0.8), #0a0a0a), url('../tlo.png'); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; }
        .coyote-text { color: var(--coyote); font-family: 'Orbitron'; }

        input, select, textarea {
            background: #111 !important;
            border: 1px solid #222 !important;
            color: white !important;
            padding: 16px 20px !important;
            border-radius: 12px;
            width: 100%;
            outline: none;
            transition: 0.3s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--coyote) !important; background: #161616 !important; }

        .btn-send {
            background: var(--coyote);
            color: black;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 20px;
            border-radius: 12px;
            transition: 0.3s;
            cursor: pointer;
        }
        .btn-send:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(193, 154, 107, 0.2); }

        .form-disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(100%);
        }
    </style>
</head>
<body>

    <nav class="h-[73px] border-b border-zinc-900 sticky top-0 bg-black/95 z-50 backdrop-blur-md flex items-center relative">
        <a href="../index.html" class="absolute left-4 md:left-8 text-zinc-500 hover:text-white transition text-xl">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <div class="container mx-auto px-6 flex justify-center">
            <div class="uppercase font-bold text-[11px] tracking-[0.3em] font-[Orbitron] text-zinc-400">
                KONTAKT.<span class="coyote-text">STRZELCA</span>.PL
            </div>
        </div>
    </nav>

    <header class="hero-bg text-center px-6 uppercase font-[Orbitron]">
        <h1 class="text-3xl md:text-5xl font-black italic">Kontakt <span class="coyote-text">STRZELCA</span></h1>
    </header>

    <!-- Sekcja z tekstem i ikonami mediów społecznościowych -->
    <section class="py-16 container mx-auto px-6 text-center">
        <div class="max-w-4xl mx-auto">
            <p class="text-xl md:text-2xl text-zinc-300 mb-8 leading-relaxed">
                Aby złożyć zamówienie, ofertę współpracy lub dopytać o produkt skontaktuj się z nami za pomocą poniższych narzędzi lub zaloguj się i napisz do nas na czacie.
            </p>

            <div class="flex justify-center space-x-8 mb-12">
                <a href="#" onclick="copyEmail()" class="group" title="Skopiuj email do schowka">
                    <div class="w-16 h-16 bg-zinc-800 hover:bg-zinc-700 rounded-full flex items-center justify-center transition-all duration-300 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-coyote/20">
                        <i class="fa-solid fa-envelope text-2xl text-zinc-400 group-hover:text-coyote"></i>
                    </div>
                </a>

                <a href="https://facebook.com/strzelca.pl" target="_blank" rel="noopener" class="group" title="Facebook">
                    <div class="w-16 h-16 bg-zinc-800 hover:bg-zinc-700 rounded-full flex items-center justify-center transition-all duration-300 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-blue-500/20">
                        <i class="fa-brands fa-facebook-f text-2xl text-zinc-400 group-hover:text-blue-400"></i>
                    </div>
                </a>

                <a href="https://instagram.com/strzelca.pl" target="_blank" rel="noopener" class="group" title="Instagram">
                    <div class="w-16 h-16 bg-zinc-800 hover:bg-zinc-700 rounded-full flex items-center justify-center transition-all duration-300 group-hover:scale-110 group-hover:shadow-lg group-hover:shadow-pink-500/20">
                        <i class="fa-brands fa-instagram text-2xl text-zinc-400 group-hover:text-pink-400"></i>
                    </div>
                </a>
            </div>

        </div>
    </section>

    <section class="py-20 container mx-auto px-6 max-w-3xl">
        <div class="bg-zinc-900/50 p-8 md:p-12 rounded-3xl border border-zinc-800 shadow-2xl">
            <h2 class="text-2xl font-bold coyote-text mb-6 text-center">Czat STRZELCA</h2>

            <form id="chat-form" class="space-y-6">
                <div>
                    <label class="text-[10px] uppercase font-bold text-zinc-500 ml-2 mb-2 block tracking-widest">Temat rozmowy</label>
                    <select id="chat-topic" required class="py-4">
                        <option value="" disabled selected>Wybierz temat...</option>
                        <option value="Zamówienie">Zamówienie</option>
                        <option value="Pytanie o produkt">Pytanie o produkt</option>
                        <option value="Współpraca">Współpraca</option>
                        <option value="Inne">Inne</option>
                    </select>
                </div>

                <div>
                    <label class="text-[10px] uppercase font-bold text-zinc-500 ml-2 mb-2 block tracking-widest">Twoja wiadomość</label>
                    <textarea id="chat-message" rows="4" placeholder="Napisz wiadomość, którą chcesz wysłać do naszego zespołu..." required></textarea>
                </div>

                <div class="text-center">
                    <p id="regulamin-info" class="text-xs text-zinc-500 mb-4 hidden">
                        Składając zamówienie akceptujesz <a href="reg-zam.html" class="text-coyote hover:underline" target="_blank">Regulamin Zamówień i Zwrotów</a>.
                    </p>
                    <button type="submit" class="btn-send">Rozpocznij czat</button>
                </div>
            </form>
        </div>
    </section>

    <div class="text-center py-6 border-t border-zinc-900 text-zinc-600 text-[10px] uppercase font-bold tracking-[0.3em]">
        <a href="reg-zam.html" class="hover:text-coyote transition">Regulamin zamówień i zwrotów</a>
    </div>


    <footer class="text-center py-10 border-t border-zinc-900 text-zinc-700 text-[10px] uppercase font-bold tracking-[0.4em]">
        <a href="../index.html" class="hover:text-white transition">STRZELCA.PL</a> |
        <a href="https://dokumenty.strzelca.pl" class="hover:text-white transition ml-4">DOKUMENTY - REGULAMINY, ZWROTY ITP.</a>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, setDoc, query, orderBy, limit, getDocs, updateDoc, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyD_gXFh3a4NW9Hzzsr5IQuDADM2GVpPMVc",
          authDomain: "strzelca-pl.firebaseapp.com",
          projectId: "strzelca-pl",
          storageBucket: "strzelca-pl.firebasestorage.app",
          messagingSenderId: "511362047688",
          appId: "1:511362047688:web:9b82c0a4d19c1a3a878ffd",
          measurementId: "G-9EJ2R3JPVD"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Funkcja sprawdzająca stan logowania i kontrolująca formularz
        function checkLoginStatus() {
            const { getAuth, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");
            const auth = getAuth();

            onAuthStateChanged(auth, (user) => {
                const chatForm = document.getElementById('chat-form');
                const loginPrompt = document.getElementById('login-prompt');

                if (user && user.emailVerified) {
                    // Użytkownik zalogowany - włącz formularz
                    chatForm.classList.remove('form-disabled');
                    if (loginPrompt) loginPrompt.style.display = 'none';
                } else {
                    // Użytkownik niezalogowany - wyłącz formularz
                    chatForm.classList.add('form-disabled');
                    if (!loginPrompt) {
                        // Dodaj komunikat o konieczności logowania
                        const prompt = document.createElement('div');
                        prompt.id = 'login-prompt';
                        prompt.className = 'text-center p-4 bg-zinc-800 rounded-lg mt-4';
                        prompt.innerHTML = `
                            <p class="text-zinc-300 mb-2">Aby wysłać wiadomość, musisz być zalogowany.</p>
                            <a href="../konta/login.html" class="text-coyote hover:underline">Zaloguj się na konto Strzelca</a>
                            <span class="text-zinc-500 mx-2">|</span>
                            <a href="../konta/rejestracja.html" class="text-coyote hover:underline">Załóż konto Strzelca</a>
                        `;
                        chatForm.parentNode.insertBefore(prompt, chatForm.nextSibling);
                    } else {
                        loginPrompt.style.display = 'block';
                    }
                }
            });
        }

        // Funkcje pomocnicze
        window.copyEmail = async () => {
            const email = 'kontakt@strzelca.pl';
            try {
                await navigator.clipboard.writeText(email);
                alert('Email został skopiowany do schowka: ' + email);

                // Spróbuj otworzyć klienta poczty
                window.location.href = `mailto:${email}`;
            } catch (err) {
                console.error('Błąd kopiowania email:', err);
                // Fallback - otwórz klienta poczty
                window.location.href = `mailto:${email}`;
            }
        };


        // --- OBSŁUGA FORMULARZA CZATU ---
        document.getElementById('chat-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Sprawdź czy użytkownik jest zalogowany
            const { getAuth, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");
            const auth = getAuth();

            let currentUser = null;
            await new Promise(resolve => {
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    unsubscribe();
                    resolve();
                });
            });

            const formData = {
                senderName: currentUser ? currentUser.displayName : 'Gość',
                senderEmail: currentUser ? currentUser.email : 'guest@strzelca.pl',
                topic: document.getElementById('chat-topic').value,
                content: document.getElementById('chat-message').value,
                timestamp: Date.now(),
                senderId: currentUser ? currentUser.uid : null,
                senderType: currentUser ? 'user' : 'guest',
                isRead: false,
                conversationType: 'support_chat'
            };

            // Sprawdzenie czy wszystkie pola są wypełnione
            if (!formData.topic || !formData.content.trim()) {
                alert('Proszę wybrać temat i wpisać wiadomość.');
                return;
            }

            // Zabezpieczenie przed botami - sprawdzenie ostatniej wiadomości
            try {
                let rateLimitQuery;
                if (currentUser) {
                    rateLimitQuery = query(
                        collection(db, "chatMessages"),
                        where("senderId", "==", currentUser.uid),
                        orderBy("timestamp", "desc"),
                        limit(1)
                    );
                } else {
                    rateLimitQuery = query(
                        collection(db, "chatMessages"),
                        where("senderType", "==", "guest"),
                        orderBy("timestamp", "desc"),
                        limit(1)
                    );
                }

                const lastMessageSnap = await getDocs(rateLimitQuery);

                if (!lastMessageSnap.empty) {
                    const lastMessage = lastMessageSnap.docs[0].data();
                    const timeDiff = Date.now() - lastMessage.timestamp;
                    const oneMinute = 60 * 1000; // 1 minuta w milisekundach

                    if (timeDiff < oneMinute) {
                        alert('Można wysłać tylko jedną wiadomość na minutę. Spróbuj ponownie za chwilę.');
                        return;
                    }
                }

                // Znajdź lub utwórz konwersację z administratorem
                let conversationId;

                if (currentUser) {
                    // Dla zalogowanych użytkowników - znajdź istniejącą konwersację z adminem
                    const conversationQuery = query(
                        collection(db, "conversations"),
                        where("participants", "array-contains", currentUser.uid),
                        where("type", "==", "support_chat")
                    );
                    const conversationSnap = await getDocs(conversationQuery);

                    if (!conversationSnap.empty) {
                        conversationId = conversationSnap.docs[0].id;
                    } else {
                        // Utwórz nową konwersację
                        const newConversation = {
                            participants: [currentUser.uid, 'admin'],
                            type: 'support_chat',
                            adminName: 'Pomoc Strzelca',
                            createdAt: Date.now(),
                            lastMessage: formData.content.substring(0, 100),
                            lastMessageTime: formData.timestamp,
                            unreadCount: { [currentUser.uid]: 0, admin: 1 }
                        };
                        const conversationRef = doc(collection(db, "conversations"));
                        await setDoc(conversationRef, newConversation);
                        conversationId = conversationRef.id;
                    }
                } else {
                    // Dla gości - utwórz nową konwersację gościa z identyfikatorem sesji
                    const sessionId = 'guest_' + Date.now();
                    const newConversation = {
                        participants: [sessionId, 'admin'],
                        type: 'guest_support',
                        adminName: 'Pomoc Strzelca',
                        guestSessionId: sessionId,
                        createdAt: Date.now(),
                        lastMessage: formData.content.substring(0, 100),
                        lastMessageTime: formData.timestamp,
                        unreadCount: { [sessionId]: 0, admin: 1 }
                    };
                    const conversationRef = doc(collection(db, "conversations"));
                    await setDoc(conversationRef, newConversation);
                    conversationId = conversationRef.id;
                }

                // Dodaj wiadomość do konwersacji
                await setDoc(doc(collection(db, "chatMessages")), {
                    ...formData,
                    conversationId: conversationId,
                    recipientId: 'admin',
                    recipientType: 'admin',
                    recipientName: 'Pomoc Strzelca'
                });

                // Zaktualizuj informacje o ostatniej wiadomości w konwersacji
                const conversationRef = doc(db, "conversations", conversationId);
                const conversationSnap = await getDoc(conversationRef);
                const conversationData = conversationSnap.data();

                await updateDoc(conversationRef, {
                    lastMessage: formData.content.substring(0, 100),
                    lastMessageTime: formData.timestamp,
                    unreadCount: {
                        ...conversationData.unreadCount,
                        admin: (conversationData.unreadCount?.admin || 0) + 1
                    }
                });

                alert('Wiadomość została wysłana! Otrzymasz powiadomienie email o odpowiedzi od naszego zespołu.');
                document.getElementById('chat-form').reset();

            } catch (err) {
                console.error('Błąd wysyłania wiadomości:', err);
                alert('Wystąpił błąd podczas wysyłania wiadomości. Spróbuj ponownie.');
            }
        });

        // Funkcja do obsługi wyświetlania informacji o regulaminie
        function toggleRegulaminInfo() {
            const topicSelect = document.getElementById('chat-topic');
            const regulaminInfo = document.getElementById('regulamin-info');

            if (topicSelect.value === 'Zamówienie') {
                regulaminInfo.classList.remove('hidden');
            } else {
                regulaminInfo.classList.add('hidden');
            }
        }

        // Funkcja do obsługi parametrów URL
        function handleUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const product = urlParams.get('product');
            const topic = urlParams.get('topic');

            if (topic && topic.toUpperCase() === 'ZAMOWIENIE') {
                const select = document.getElementById('chat-topic');
                select.value = 'Zamówienie';

                if (product) {
                    const msgField = document.getElementById('chat-message');
                    const currentValue = msgField.value;
                    if (!currentValue || currentValue.trim() === '') {
                        msgField.value = `Zamówienie: ${product}\n\nDodatkowe informacje: `;
                    }
                }
            }
        }

        // Sprawdź stan logowania przy ładowaniu strony
        checkLoginStatus();

        // Obsługuj parametry URL
        handleUrlParams();

        // Dodaj event listener na zmianę tematu
        document.getElementById('chat-topic').addEventListener('change', toggleRegulaminInfo);

        // Sprawdź temat przy ładowaniu strony
        toggleRegulaminInfo();
    </script>
</body>
</html>